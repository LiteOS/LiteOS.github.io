(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{169:function(a,t,s){a.exports=s.p+"assets/img/raw-project-copy-liteos.0fcbb562.png"},310:function(a,t,s){a.exports=s.p+"assets/img/raw-project-list-gcc.3194ccd3.png"},311:function(a,t,s){a.exports=s.p+"assets/img/raw-project-first-compile-gcc.faf7e097.png"},312:function(a,t,s){a.exports=s.p+"assets/img/raw-project-copy-osconfig.bc5fe825.png"},313:function(a,t,s){a.exports=s.p+"assets/img/raw-project-fix-makefile.0f84af10.png"},314:function(a,t,s){a.exports=s.p+"assets/img/raw-project-compile-ok-gcc.20961fcc.png"},315:function(a,t,s){a.exports=s.p+"assets/img/raw-project-build-result.b2cfe7f4.png"},786:function(a,t,s){"use strict";s.r(t);var e=[function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"content"},[e("h1",{attrs:{id:"stm32-系列（makefile-gcc）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#stm32-系列（makefile-gcc）","aria-hidden":"true"}},[a._v("#")]),a._v(" STM32 系列（Makefile/GCC）")]),a._v(" "),e("p",[e("a",{attrs:{href:"/porting/F103ZE_LiteOS_gcc.rar"}},[a._v("移植工程下载")])]),a._v(" "),e("h2",{attrs:{id:"编译-stm32cube-生成的裸机工程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编译-stm32cube-生成的裸机工程","aria-hidden":"true"}},[a._v("#")]),a._v(" 编译 STM32Cube 生成的裸机工程")]),a._v(" "),e("p",[a._v("默认的裸机工程如下图所示，会按照代码功能组织好。我们可以执行编译检查工程是否 OK。")]),a._v(" "),e("p",[e("img",{attrs:{src:s(310),alt:""}})]),a._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),e("p",[a._v("请务必提前安装好 "),e("strong",[a._v("GNU Tools ARM Embedded")]),a._v(" 工具链环境，在 STM32Cube 导出的裸机工程下执行 make 命令。如果能看到下图所示结果，证明您的环境已经部署好。")])]),a._v(" "),e("p",[e("img",{attrs:{src:s(311),alt:""}})]),a._v(" "),e("h2",{attrs:{id:"拷贝-liteos-kernel-相关目录到裸机工程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#拷贝-liteos-kernel-相关目录到裸机工程","aria-hidden":"true"}},[a._v("#")]),a._v(" 拷贝 LiteOS Kernel 相关目录到裸机工程")]),a._v(" "),e("p",[e("img",{attrs:{src:s(169),alt:""}})]),a._v(" "),e("p",[e("img",{attrs:{src:s(312),alt:""}})]),a._v(" "),e("p",[a._v("在 STM32Cube 生产的裸机工程中创建 "),e("strong",[a._v("Middlewares")]),a._v(" 目录，直接拷贝 LiteOS Kernel 相关目录。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("├─ Middlewares\n│  └─ LiteOS\n│     ├─ arch\n│     ├─ examples\n│     └─ kernel\n├─ OS_CONFIG\n")])])]),e("h2",{attrs:{id:"创建-liteos-kernel-相关-makefile-文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-liteos-kernel-相关-makefile-文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 创建 LiteOS Kernel 相关 makefile 文件")]),a._v(" "),e("p",[a._v("创建 "),e("code",[a._v("arch.mk")]),a._v(" 文件，添加 "),e("code",[a._v("arch")]),a._v(" 目录下相关的源文件和头文件路径")]),a._v(" "),e("div",{staticClass:"language-makefile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-makefile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# source")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# C sources")]),a._v("\nARCH_SRC "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("  \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/arch/arm/arm-m/src/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        C_SOURCES "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ARCH_SRC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ASM sources")]),a._v("\nASM_SOURCES_S "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+=")]),a._v("  \\\n../Middlewares/LiteOS/arch/arm/arm-m/cortex-m3/gcc/los_dispatch_gcc.S \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# C includes")]),a._v("\nARCH_INC "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" \\\n        -I../Middlewares/LiteOS/arch/arm/arm-m/"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("include")]),a._v(" \\\n        -I../Middlewares/LiteOS/arch/arm/common/cmsis\n        C_INCLUDES "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ARCH_INC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("p",[a._v("创建 "),e("code",[a._v("kernel.mk")]),a._v(" 文件，添加 "),e("code",[a._v("kernel")]),a._v(" 目录下相关的源文件和头文件路径")]),a._v(" "),e("div",{staticClass:"language-makefile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-makefile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# C sources")]),a._v("\nKERNEL_SRC "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("  \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/core/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/ipc/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/mem/bestfit_little/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/mem/membox/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/mem/common/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/misc/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/om/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/extended/tickless/*.c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        C_SOURCES "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("KERNEL_SRC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# C includes")]),a._v("\nKERNEL_INC "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" \\\n        -I ../Middlewares/LiteOS/kernel/base/"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("include")]),a._v("  \\\n        -I ../Middlewares/LiteOS/kernel/extended/"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("include")]),a._v("  \\\n        -I ../Middlewares/LiteOS/kernel/"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("include")]),a._v("\n        C_INCLUDES "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("KERNEL_INC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n")])])]),e("p",[a._v("最后修改 Makefile 文件，将刚刚创建好的 arch.mk 和 kernel.mk 包含进来。")]),a._v(" "),e("p",[e("img",{attrs:{src:s(313),alt:""}})]),a._v(" "),e("div",{staticClass:"language-makefile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-makefile"}},[e("code",[a._v("OBJECTS "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("addprefix "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("BUILD_DIR"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("/,"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("notdir")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ASM_SOURCES_S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(".S"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(".o"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("vpath")]),a._v(" %.S "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("sort")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("dir")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ASM_SOURCES_S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token symbol"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),a._v("(BUILD_DIR)/%.o")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" %.S Makefile "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("BUILD_DIR"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\t"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("AS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" -c "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("CFLAGS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$<")]),a._v(" -o "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$@")]),a._v("\n")])])]),e("h3",{attrs:{id:"编译无误，os-移植大功告成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编译无误，os-移植大功告成","aria-hidden":"true"}},[a._v("#")]),a._v(" 编译无误，OS 移植大功告成")]),a._v(" "),e("p",[e("img",{attrs:{src:s(314),alt:""}})]),a._v(" "),e("p",[a._v("可以在 "),e("code",[a._v("build")]),a._v(" 目录下找到编译好的 bin 文件")]),a._v(" "),e("p",[e("img",{attrs:{src:s(315),alt:""}})])])}],n=s(0),r=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},e,!1,null,null,null);r.options.__file="stm32-makefile.md";t.default=r.exports}}]);